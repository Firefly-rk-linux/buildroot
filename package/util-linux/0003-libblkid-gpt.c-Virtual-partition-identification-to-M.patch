From adf9f4347da7f9bec7795403fcef8f94035d324e Mon Sep 17 00:00:00 2001
From: dengkx <service@t-firefly.com>
Date: Tue, 1 Mar 2022 16:51:53 +0800
Subject: [PATCH] libblkid: gpt.c: Virtual partition identification to MBR
 error skipped processing

---
 libblkid/src/partitions/gpt.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/libblkid/src/partitions/gpt.c b/libblkid/src/partitions/gpt.c
index c907c0de4..fb45e3a66 100644
--- a/libblkid/src/partitions/gpt.c
+++ b/libblkid/src/partitions/gpt.c
@@ -250,8 +250,12 @@ static int is_pmbr_valid(blkid_probe pr, int *has)
 		goto failed;
 	}
 
-	if (!mbr_is_valid_magic(data))
-		goto failed;
+	if (!mbr_is_valid_magic(data)) {
+		if (choose_partition_lba() != 1)
+			return 1;
+		else
+			goto failed;
+	}
 
 	for (i = 0, p = mbr_get_partition(data, 0); i < 4; i++, p++) {
 		if (p->sys_ind == MBR_GPT_PARTITION) {
-- 
2.25.1

